!function(a){a.fn.getCode=function(b){function c(){var c=b.validReg.test(g.val()),d=window.localStorage.getItem(b.countTag);d||(c?a.unlockBtn(h,b.defaultTxt):a.lockBtn(h,b.defaultTxt))}function d(){function d(){var d=(new Date).getTime(),g=b.countTime-Math.floor((d-f)/1e3);0>=g?(window.localStorage.removeItem(b.countTag),a.unlockBtn(h,b.defaultTxt),c()):h.val(e(g))}var f=window.localStorage.getItem(b.countTag);clearInterval(i),d(),i=setInterval(d,1e3)}function e(a){return[b.insertStr,a,b.appendStr].join("")}var f={countTime:180,countTag:"countTime",bind:"#mobile",validReg:/(.*)+/,defaultTxt:"获取验证码",needRefresh:!1,debounce:100,touch:!0,insertStr:"等待",appendStr:"秒后,再次获取",sendCode:function(){}};b=a.extend(f,b||{});var g=a(b.bind),h=a(this),i=null;a.lockBtn(h,b.defaultTxt),b.needRefresh?window.localStorage.removeItem(b.countTag):d();var j=a.debounce(c,b.debounce);c(),g.on("input",j);var k=b.touch?"tap":"click";h.on(k,function(){var c=a(this),f=c.is(":disabled");f||(window.localStorage.setItem(b.countTag,(new Date).getTime()),a.lockBtn(h,e(b.countTime)),d(),b.sendCode.call(h,g.val()))})}}(Zepto),$.lockBtn=function(a,b){var c=$(a);c.attr("disabled","disabled"),$.isBtn(c)?c.text(b):c.val(b)},$.unlockBtn=function(a,b){var c=$(a);c.removeAttr("disabled"),$.isBtn(c)?c.text(b):c.val(b)},$.isBtn=function(a){var b=$(a)[0].nodeName;return"BUTTON"===b},$.debounce=function(a,b){var c=null;return function(){clearTimeout(c),c=setTimeout(a,b)}},function(a){a.fn.validate=function(b){function c(){a.unlockBtn(j,b.defaultTxt),b.touch&&j.on("click",d).on("tap",function(){a(this).is(":disabled")||e()}),i.on("submit",function(c){d(c),f(i)&&(a.lockBtn(j,b.loadingTxt),g(i))})}function d(a){a.preventDefault()}function e(){i.trigger("submit")}function f(a){for(var c=a.serializeArray(),d=0;d<c.length;d++){var e=b.validConf[c[d].name],f=c[d].value;if(e)if(""===f){if(e.required!==!1)return b.alertFn.call(null,e.required),!1}else if(e.reg&&!e.reg.exp.test(f))return b.alertFn.call(null,e.reg.msg),!1}return!0}function g(c){var d=c.serializeArray(),e={};a.each(d,function(a,b){e[b.name]=b.value}),b.validSuccess.call(j,e)}var h={validConf:{},touch:!0,loadingTxt:"正在提交",defaultTxt:"提交",validSuccess:function(a){},alertFn:window.alert};b=a.extend(h,b||{});var i=a(this);if("FORM"!==i[0].nodeName)throw new Error("the element must be a form");var j=i.find('[type="submit"]');c()}}(Zepto);